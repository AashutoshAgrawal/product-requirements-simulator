{% extends "base.html" %}

{% block title %}Results - Elicitron{% endblock %}

{% block content %}
<div class="results-header">
    <h2>Requirements Elicitation Results</h2>
    <div class="results-actions">
        <a href="/" class="btn-secondary">Analyze Another Product</a>
        <a href="/api/results/{{ job_id }}" class="btn-secondary" download="results.json">Download JSON</a>
    </div>
</div>

<div class="executive-summary">
    <h3>Executive Summary</h3>
    <div class="summary-stats">
        <div class="stat-card">
            <div class="stat-value">{{ results.aggregated_needs.total_needs }}</div>
            <div class="stat-label">Total Needs Extracted</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ results.metadata.n_agents }}</div>
            <div class="stat-label">User Agents</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ results.aggregated_needs.summary.by_category|length }}</div>
            <div class="stat-label">Need Categories</div>
        </div>
    </div>
</div>

<div class="methodology-walkthrough">
    <h3>Methodology Walkthrough</h3>
    
    <div class="methodology-section">
        <h4>Stage 1: Agent Generation</h4>
        <p>Generated {{ results.agents|length }} diverse user personas:</p>
        <div class="agents-list">
            {% for agent in results.agents %}
            <div class="agent-card">
                <div class="agent-content">{{ agent|truncate(200) }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <div class="methodology-section">
        <h4>Stage 2: Experience Simulation</h4>
        <p>Simulated {{ results.experiences|length }} user experiences using Action/Observation/Challenge format:</p>
        {% if results.experiences %}
        <div class="experience-sample">
            <h5>Sample Experience (Agent {{ results.experiences[0].agent_id }}):</h5>
            <div class="experience-content">{{ results.experiences[0].experience|truncate(500) }}</div>
        </div>
        {% endif %}
    </div>
    
    <div class="methodology-section">
        <h4>Stage 3: Interview Simulation</h4>
        <p>Conducted {{ results.interviews|length }} structured interviews:</p>
        {% if results.interviews and results.interviews[0].interview %}
        <div class="interview-sample">
            <h5>Sample Interview Q&A:</h5>
            {% for qa in results.interviews[0].interview[:2] %}
            <div class="qa-pair">
                <div class="question"><strong>Q:</strong> {{ qa.question }}</div>
                <div class="answer"><strong>A:</strong> {{ qa.answer|truncate(300) }}</div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <div class="methodology-section">
        <h4>Stage 4: Latent Need Extraction</h4>
        <p>Extracted and classified {{ results.aggregated_needs.total_needs }} latent needs:</p>
    </div>
</div>

<div class="needs-analysis">
    <h3>Needs Analysis</h3>
    
    <div class="needs-by-category">
        <h4>Needs by Category</h4>
        <div class="category-stats">
            {% for category, count in results.aggregated_needs.summary.by_category.items() %}
            <div class="category-item">
                <span class="category-name">{{ category }}</span>
                <span class="category-count">{{ count }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <div class="needs-by-priority">
        <h4>Needs by Priority</h4>
        <div class="priority-stats">
            {% for priority, count in results.aggregated_needs.summary.by_priority.items() %}
            <div class="priority-item priority-{{ priority.lower() }}">
                <span class="priority-name">{{ priority }}</span>
                <span class="priority-count">{{ count }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <div class="all-needs">
        <h4>All Extracted Needs</h4>
        <div class="needs-list">
            {% for extraction in results.need_extractions %}
                {% for need in extraction.needs %}
                <div class="need-card">
                    <div class="need-header">
                        <span class="need-category">{{ need.category }}</span>
                        <span class="need-priority priority-{{ need.priority.lower() }}">{{ need.priority }}</span>
                    </div>
                    <div class="need-statement">{{ need.need_statement }}</div>
                    <div class="need-evidence"><strong>Evidence:</strong> {{ need.evidence|truncate(200) }}</div>
                    <div class="need-implication"><strong>Design Implication:</strong> {{ need.design_implication }}</div>
                </div>
                {% endfor %}
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

