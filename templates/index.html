{% extends "base.html" %}

{% block title %}Elicitron - Product Requirements Generator{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Product Requirements Elicitation</h2>
    <p>Enter your product idea to generate comprehensive user requirements using the Elicitron methodology</p>
</div>

<div class="methodology-overview">
    <h3>The Elicitron Methodology (4 Stages)</h3>
    <div class="stages-diagram">
        <div class="stage-card">
            <div class="stage-number">1</div>
            <h4>Agent Generation</h4>
            <p>Generate diverse user personas representing different user segments</p>
        </div>
        <div class="stage-arrow">→</div>
        <div class="stage-card">
            <div class="stage-number">2</div>
            <h4>Experience Simulation</h4>
            <p>Simulate user interactions with Action/Observation/Challenge format</p>
        </div>
        <div class="stage-arrow">→</div>
        <div class="stage-card">
            <div class="stage-number">3</div>
            <h4>Interview Simulation</h4>
            <p>Conduct structured interviews based on simulated experiences</p>
        </div>
        <div class="stage-arrow">→</div>
        <div class="stage-card">
            <div class="stage-number">4</div>
            <h4>Latent Need Extraction</h4>
            <p>Extract and classify underlying user needs by category and priority</p>
        </div>
    </div>
</div>

<div class="input-form-container">
    <form id="analyze-form" method="POST" action="/analyze">
        <div class="form-group">
            <label for="product_idea">Product Idea *</label>
            <textarea 
                id="product_idea" 
                name="product_idea" 
                rows="4" 
                placeholder="Describe your product idea (e.g., 'A smartwatch for fitness tracking' or 'A mobile app for meal planning')"
                required
            ></textarea>
            <small>Describe what you're planning to build</small>
        </div>
        
        <div class="form-group">
            <label for="design_context">Design Context</label>
            <input 
                type="text" 
                id="design_context" 
                name="design_context" 
                placeholder="Optional: More specific context (e.g., 'fitness tracking for beginners')"
            />
            <small>Optional: Additional context for generating diverse user personas</small>
        </div>
        
        <div class="form-group">
            <label for="n_agents">Number of User Agents</label>
            <div class="slider-container">
                <input 
                    type="range" 
                    id="n_agents" 
                    name="n_agents" 
                    min="1" 
                    max="10" 
                    value="5"
                    oninput="document.getElementById('agent-count').textContent = this.value"
                />
                <span id="agent-count">5</span>
            </div>
            <small>More agents = more diverse perspectives (but takes longer)</small>
        </div>
        
        <button type="submit" class="btn-primary" id="submit-btn">
            <span>Analyze Product</span>
            <span class="loading-spinner" style="display: none;">⏳</span>
        </button>
    </form>
</div>

<div id="error-message" class="error-message" style="display: none;"></div>
{% endblock %}

{% block extra_scripts %}
<script>
document.getElementById('analyze-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const submitBtn = document.getElementById('submit-btn');
    const errorMsg = document.getElementById('error-message');
    const spinner = submitBtn.querySelector('.loading-spinner');
    
    submitBtn.disabled = true;
    spinner.style.display = 'inline';
    errorMsg.style.display = 'none';
    
    const formData = {
        product_idea: document.getElementById('product_idea').value,
        design_context: document.getElementById('design_context').value,
        n_agents: parseInt(document.getElementById('n_agents').value)
    };
    
    fetch('/analyze', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            errorMsg.textContent = data.error;
            errorMsg.style.display = 'block';
            submitBtn.disabled = false;
            spinner.style.display = 'none';
        } else {
            window.location.href = data.redirect_url;
        }
    })
    .catch(error => {
        errorMsg.textContent = 'Error: ' + error.message;
        errorMsg.style.display = 'block';
        submitBtn.disabled = false;
        spinner.style.display = 'none';
    });
});
</script>
{% endblock %}

